        org $040000
        dc.b 48,48,48,0,72,208,0,64,212,0,60,212,0,56,216,0,48,220,0,44,224,0,40,228
        dc.b 0,32,232,0,28,232,0,24,236,0,16,240,0,12,244,0,8,248,0,0,252,4,0,248
        dc.b 8,0,244,12,0,240,16,0,236,20,0,232,24,0,228,28,0,224,32,0,220,36,0,216
        dc.b 40,0,212,44,0,208,48,0,204,52,0,200,56,0,196,60,0,192,64,0,188,68,0,184
        dc.b 72,0,180,76,0,176,80,0,172,84,0,168,88,0,164,92,0,160,96,0,156,100,0,152
        dc.b 104,0,148,108,0,144,112,0,140,116,0,136,120,0,132,128,0,124,132,0,120,136,0,116
        dc.b 140,0,112,144,0,108,148,0,104,160,0,100,156,0,96,160,0,92,164,0,88,168,0,84
        dc.b 172,0,80,176,0,76,180,0,72,184,0,68,188,0,64,192,0,60,196,0,56,200,0,52
        dc.b 204,0,48,208,0,44,212,0,40,216,0,36,220,0,32,224,0,28,228,0,24,232,0,20
        dc.b 236,0,16,240,0,12,244,0,8,252,0,0,252,0,0,252,0,0,252,0,0,252,4,0
        dc.b 252,8,0,252,12,0,252,16,0,252,20,0,252,24,0,252,28,0,252,32,0,252,36,0
        dc.b 252,40,0,252,44,0,252,48,0,252,52,0,252,56,0,252,60,0,252,64,0,252,68,0
        dc.b 252,72,0,252,76,0,252,80,0,252,84,0,252,88,0,252,92,0,252,96,0,252,100,0
        dc.b 252,104,0,252,108,0,252,112,0,252,116,0,252,120,0,252,124,0,252,128,0,252,132,0
        dc.b 252,136,0,252,140,0,252,144,0,252,148,0,252,152,0,252,156,0,252,160,0,252,164,0
        dc.b 252,168,0,252,172,0,252,176,0,252,180,0,252,184,0,252,188,0,252,192,0,252,196,0
        dc.b 252,200,0,252,204,0,252,208,0,252,212,0,252,216,0,252,220,0,252,224,0,252,228,0
        dc.b 252,232,0,252,236,0,252,240,0,252,244,0,252,248,0,252,252,0,252,252,0,248,252,0
        dc.b 244,252,0,240,252,0,236,252,0,232,252,0,228,252,0,224,252,0,220,252,0,216,252,0
        dc.b 212,252,0,208,252,0,204,252,0,200,252,0,196,252,0,192,252,0,188,252,0,184,252,0
        dc.b 180,252,0,176,252,0,172,252,0,168,252,0,164,252,0,160,252,0,156,252,0,152,252,0
        dc.b 148,252,0,144,252,0,140,252,0,136,252,0,132,252,0,128,252,0,124,252,0,120,252,0
        dc.b 116,252,0,112,252,0,108,252,0,104,252,0,100,252,0,96,252,0,92,252,0,88,252,0
        dc.b 84,252,0,80,252,0,76,252,0,72,252,0,68,252,0,64,252,0,64,252,0,64,252,4
        dc.b 60,248,8,60,248,12,60,248,12,56,244,16,56,244,20,56,240,24,52,240,24,52,240,28
        dc.b 52,236,32,48,236,36,48,232,36,48,232,40,44,232,44,44,228,48,44,228,48,40,224,52
        dc.b 40,224,56,40,224,60,36,220,60,36,220,64,36,216,68,32,216,72,32,216,76,28,212,76
        dc.b 28,212,80,28,212,84,24,208,88,24,208,88,24,204,92,20,204,96,20,204,100,20,200,100
        dc.b 16,200,104,16,196,108,16,196,112,12,196,112,12,192,116,12,192,120,8,188,124,8,188,124
        dc.b 8,188,128,4,184,132,4,184,136,0,180,140,0,176,140,0,172,144,0,168,148,0,160,152
        dc.b 0,156,156,0,152,156,0,144,160,0,140,164,0,136,168,0,128,172,0,124,176,0,120,176
        dc.b 0,112,180,0,108,184,0,104,188,0,96,192,0,92,192,0,88,196,0,80,200,0,76,204


fbuffer equ     $020000
sideexp equ     8


        org     $010000 ; funzioni
        dc.l    lineclr,plasma,figo



        org     $2000
sintbl  dc.b 0,1,3,4,6,7,9,10,12,14,15,17,18,20,21,23
        dc.b 24,26,28,29,31,32,34,35,37,38,40,41,43,44,46,47
        dc.b 48,50,51,53,54,56,57,58,60,61,63,64,65,67,68,69
        dc.b 71,72,73,74,76,77,78,79,81,82,83,84,85,87,88,89
        dc.b 90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105
        dc.b 106,107,108,108,109,110,111,112,112,113,114,115,115,116,117,117
        dc.b 118,118,119,119,120,121,121,122,122,122,123,123,124,124,124,125
        dc.b 125,125,126,126,126,126,127,127,127,127,127,127,127,127,127,127
        dc.b -128,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-126,-126,-126,-126,-125
        dc.b -125,-125,-124,-124,-124,-123,-123,-122,-122,-122,-121,-121,-120,-119,-119,-118
        dc.b -118,-117,-117,-116,-115,-115,-114,-113,-112,-112,-111,-110,-109,-108,-108,-107
        dc.b -106,-105,-104,-103,-102,-101,-100,-99,-98,-97,-96,-95,-94,-93,-92,-91
        dc.b -90,-89,-88,-87,-85,-84,-83,-82,-81,-79,-78,-77,-76,-74,-73,-72
        dc.b -71,-69,-68,-67,-65,-64,-63,-61,-60,-58,-57,-56,-54,-53,-51,-50
        dc.b -48,-47,-46,-44,-43,-41,-40,-38,-37,-35,-34,-32,-31,-29,-28,-26
        dc.b -24,-23,-21,-20,-18,-17,-15,-14,-12,-10,-9,-7,-6,-4,-3,-1
sin     link    a6,#0
        movem.l d0/a0,-(sp)
        clr.l   d0
        move.b  8(a6),d0        ; 4 val, 5 ret
        lea     sintbl,a0
        adda.l  d0,a0
        move.b  (a0),d0
        move.b  d0,9(a6)
        movem.l (sp)+,d0/a0
        unlk    a6
        rts

        org     $6000
lineclr link    a6,#0
        movem.l d0-d1,-(sp)
        move.b  8(a6),d1 ; y
        move.b  9(a6),d0 ; x
        adda.l  #-2,sp
        move.b  d0,(sp)
        jsr     sin
        adda.l  #1,sp
        move.b  (sp),d0
        adda.l  #1,sp
        move.b  d0,10(a6)
        movem.l (sp)+,d0-d1
        unlk    a6
        rts

        org     $6200
figo    link    a6,#0
        movem.l d0-d4,-(sp)
        move.b  8(a6),d1 ; y
        move.b  9(a6),d0 ; x

        adda.l  #-2,sp
        move.b  d0,(sp)
        sub.b   #1,(sp)
        jsr     sin
        adda.l  #1,sp
        move.b  (sp),d2 ; d2 ha un numero bello
        adda.l  #1,sp

        adda.l  #-2,sp
        move.b  d1,(sp)
        jsr     sin
        adda.l  #1,sp
        move.b  (sp),d3 ; d3 ancora più bello!!!
        adda.l  #1,sp

        adda.l  #-2,sp
        move.b  d0,(sp)
        add.b   d1,(sp)
        jsr     sin
        adda.l  #1,sp
        move.b  (sp),d4 ; d4 è fenomenale
        adda.l  #1,sp

        add.b   d4,d3
        add.b   d3,d2
        
        move.b  d2,10(a6)

        movem.l (sp)+,d0-d4
        unlk    a6
        rts

        org     $7000
plasma  link    a6,#0
        movem.l d0-d1,-(sp)
        move.b  8(a6),d1 ; y
        move.b  9(a6),d0 ; x
        adda.l  #-2,sp
        move.b  d0,(sp)
        jsr     sin
        adda.l  #1,sp
        move.b  (sp),d0
        adda.l  #1,sp
        ; in d0 ora sin x
        
        adda.l  #-2,sp
        move.b  d1,(sp)
        jsr     sin
        adda.l  #1,sp
        move.b  (sp),d1
        adda.l  #1,sp
        ; in d1 ora sin y

        add.b   d1,d0
        ;lsr.b   #1,d0
        move.b  d0,10(a6)
        movem.l (sp)+,d0-d1
        unlk    a6
        ;move
        rts


        org     $2500
drwfrm  link    a6,#0
        movem.l d0-d4/a0,-(sp)
        ; d0    max
        ; d1    posizione 0x ---- yyxx
        ; d2    y
        ; d3    colore
        ; d4    offset
        move.l  #65536,d0
        move.b  8(a6),d4 ; offset x
        clr.l   d1
        lea     fbuffer,a0
drwloop adda.l  #-3,sp
        move.w  d1,(sp) ; riservato 3 byte (y,x,ret)
        jsr     figo
        adda.l  #2,sp
        move.b  (sp),d3
        adda.l  #1,sp
        ; in d3 ora ci è il risultato della funz
        move.b  d3,(a0,d4) ; scrivo il colore
        add.l   #1,d1 ; avanzo di posizione
        adda.l  #1,a0 ; idem con gli indirizzi
        cmp.l   d1,d0
        bne     drwloop
        movem.l (sp)+,d0-d2/a0
        unlk    a6
        rts

step    equ     12

        org     $8000
main    clr.l   d0
loop    add.b    #step,d0
        adda.l  #-1,sp
        move.b  d0,(sp)        
        jsr     drwfrm
        adda.l  #1,sp
        bra     loop